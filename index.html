<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Buscador de listas grandes</title>
<style>
  :root {
    --bg: #f5f7fa;
    --card: #fff;
    --accent: #2563eb;
    --accent-light: #e0e7ff;
    --text: #1e293b;
    --muted: #64748b;
  }
  body {
    font-family: "Inter", system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    max-width: 960px;
    margin: 20px auto;
    padding: 0 16px 60px;
  }
  h1 { color: var(--accent); margin-bottom: 4px; }
  textarea {
    width: 100%; height: 200px;
    border-radius: 8px; border: 1px solid #ccc;
    font-family: monospace; padding: 10px; resize: vertical;
  }
  button {
    background: var(--accent); color: white;
    border: none; padding: 8px 14px;
    border-radius: 6px; cursor: pointer;
  }
  button:hover { background: #1d4ed8; }
  .secondary { background: var(--accent-light); color: var(--accent); }
  .secondary:hover { background: #c7d2fe; }
  input[type="text"] {
    padding: 8px 10px; border-radius: 6px; border: 1px solid #ccc;
    min-width: 240px;
  }
  .toolbar, .controls { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
  .results { margin-top: 20px; }
  .user {
    display: flex; align-items: center; gap: 12px;
    background: var(--card);
    border-radius: 12px; padding: 10px 14px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    margin-bottom: 8px; transition: transform 0.1s ease;
  }
  .user:hover { transform: scale(1.01); box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
  .user img {
    border-radius: 50%; width: 48px; height: 48px;
    object-fit: cover; border: 2px solid var(--accent-light);
  }
  .meta { font-size: 0.9rem; color: var(--muted); }
  .small { color: var(--muted); font-size: 0.85rem; }
  footer { margin-top: 30px; color: var(--muted); font-size: 0.85rem; text-align: center; }
  #loadMore { margin: 16px auto; display: block; }
</style>
</head>
<body>
<h1>⚡ Buscador rápido de listas</h1>
<p class="small">Optimizado para listas grandes. Todo ocurre localmente (sin enviar datos).</p>

<textarea id="inputHtml" placeholder="Pega aquí el HTML..."></textarea>
<div class="toolbar">
  <input type="file" id="fileInput" accept=".html,text/html" />
  <button id="parseBtn">Procesar HTML</button>
  <button class="secondary" id="clearBtn">Limpiar</button>
</div>

<div class="controls">
  <input id="search" type="text" placeholder="Buscar..." />
  <button class="secondary" id="showAll">Mostrar todos</button>
</div>

<div class="results" id="results"></div>
<button id="loadMore" style="display:none;">Mostrar más</button>

<footer>
  Hecho con ❤️ y optimizado para manejar miles de registros.
</footer>

<script>
// ====== Variables globales ======
let extracted = [];
let currentResults = [];
let renderIndex = 0;
const BATCH_SIZE = 300; // cuántos resultados mostrar por bloque

const inputHtml = document.getElementById('inputHtml');
const fileInput = document.getElementById('fileInput');
const parseBtn = document.getElementById('parseBtn');
const clearBtn = document.getElementById('clearBtn');
const searchInput = document.getElementById('search');
const resultsDiv = document.getElementById('results');
const loadMoreBtn = document.getElementById('loadMore');

// ====== Funciones ======
function escapeHtml(s){return (s||'').replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));}

// parsea el HTML y extrae los datos
function parseHtmlString(htmlString){
  const doc = new DOMParser().parseFromString(htmlString,'text/html');
  let nodes = doc.querySelectorAll('li, div, tr');
  const data = [];

  nodes.forEach(li=>{
    const nameEl = li.querySelector('span') || li.querySelector('h3');
    const userEl = li.querySelector('p') || li.querySelector('.user') || li.querySelector('.handle');
    const imgEl = li.querySelector('img');
    let name = nameEl ? nameEl.textContent.trim() : '';
    let username = userEl ? userEl.textContent.trim().replace('@','') : '';
    let photo = imgEl ? imgEl.src : '';
    if(name || username){
      data.push({
        name, username, photo,
        nameLower: name.toLowerCase(),
        usernameLower: username.toLowerCase()
      });
    }
  });
  extracted = data;
  currentResults = [...extracted];
  renderIndex = 0;
  resultsDiv.innerHTML = '';
  renderNextBatch();
}

// renderiza en bloques (para evitar congelamientos)
function renderNextBatch(){
  const next = currentResults.slice(renderIndex, renderIndex + BATCH_SIZE);
  next.forEach(item=>{
    const el = document.createElement('div');
    el.className = 'user';
    if(item.photo){
      const img = document.createElement('img');
      img.src = item.photo;
      el.appendChild(img);
    }
    const info = document.createElement('div');
    info.innerHTML = `
      <div><strong>${escapeHtml(item.name)}</strong></div>
      <div class="meta">@${escapeHtml(item.username)}</div>`;
    el.appendChild(info);
    resultsDiv.appendChild(el);
  });
  renderIndex += next.length;
  loadMoreBtn.style.display = renderIndex < currentResults.length ? 'block' : 'none';
}

// búsqueda rápida (sin similitud, pero muy eficiente)
function applySearch(){
  const q = searchInput.value.trim().toLowerCase();
  if(!q){ currentResults = [...extracted]; renderIndex=0; resultsDiv.innerHTML=''; renderNextBatch(); return; }
  currentResults = extracted.filter(e =>
    e.nameLower.includes(q) || e.usernameLower.includes(q)
  );
  renderIndex=0; resultsDiv.innerHTML='';
  renderNextBatch();
}

// ====== Eventos ======
parseBtn.onclick = ()=> parseHtmlString(inputHtml.value||'');
clearBtn.onclick = ()=>{ inputHtml.value=''; resultsDiv.innerHTML=''; loadMoreBtn.style.display='none'; extracted=[]; };
fileInput.onchange = e=>{
  const f=e.target.files[0]; if(!f)return;
  const reader=new FileReader();
  reader.onload=ev=>{ inputHtml.value=ev.target.result; parseHtmlString(inputHtml.value); };
  reader.readAsText(f);
};
searchInput.oninput = ()=>{ applySearch(); };
loadMoreBtn.onclick = renderNextBatch;
document.getElementById('showAll').onclick = ()=>{ searchInput.value=''; applySearch(); };
</script>
</body>
</html>

